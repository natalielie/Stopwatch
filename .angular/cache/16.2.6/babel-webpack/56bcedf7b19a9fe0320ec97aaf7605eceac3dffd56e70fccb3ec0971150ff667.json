{"ast":null,"code":"import { timer, BehaviorSubject, Subscription, Subject } from \"rxjs\";\nimport { takeUntil } from 'rxjs/operators';\nimport { map } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nexport class TimeService {\n  #initialTime;\n  #secondClick;\n  #delay;\n  #timer$;\n  #lastStopedTime;\n  #timerSubscription;\n  #isRunning;\n  constructor() {\n    this.#initialTime = 0;\n    this.#secondClick = false;\n    this.#delay = 0;\n    this.#timer$ = new BehaviorSubject(this.#initialTime);\n    this.#lastStopedTime = this.#initialTime;\n    this.#timerSubscription = new Subscription();\n    this.destroy$ = new Subject();\n    this.#isRunning = false;\n  }\n  get stopWatch$() {\n    return this.#timer$.pipe(map(seconds => this.secondsToStopWatch(seconds)));\n  }\n  startCount() {\n    if (this.#isRunning) {\n      return;\n    }\n    this.#timerSubscription = timer(0, 1000) // Timer, so that the first emit is instantly (interval waits until the period is over for the first emit)\n    .pipe(takeUntil(this.destroy$), map(value => value + this.#lastStopedTime)).subscribe(this.#timer$); // each emit of the Observable will result in a emit of the BehaviorSubject timer$\n    this.#isRunning = true;\n  }\n  stopTimer() {\n    this.#lastStopedTime = this.#timer$.value;\n    this.#timerSubscription.unsubscribe();\n    this.#isRunning = false;\n  }\n  resetTimer() {\n    this.#timerSubscription.unsubscribe();\n    this.#lastStopedTime = this.#initialTime;\n    this.#timer$.next(this.#initialTime);\n    this.#isRunning = false;\n  }\n  waitCount() {\n    if (!this.#secondClick) {\n      this.#secondClick = true;\n      this.#delay = Date.now();\n      return;\n    }\n    if (Date.now() - this.#delay <= 300) {\n      this.#lastStopedTime = this.#timer$.value;\n      this.#timerSubscription.unsubscribe();\n      this.#isRunning = false;\n    }\n    this.#secondClick = false;\n  }\n  secondsToStopWatch(seconds) {\n    let rest = seconds;\n    const hours = Math.floor(seconds / 3600);\n    rest = seconds % 3600;\n    const minutes = Math.floor(rest / 60);\n    rest = seconds % 60;\n    this.#secondClick = false;\n    return {\n      hours: this.convertToNumberString(hours),\n      minutes: this.convertToNumberString(minutes),\n      seconds: this.convertToNumberString(rest)\n    };\n  }\n  convertToNumberString(value) {\n    return `${value < 10 ? \"0\" + value : value}`;\n  }\n  ngOnDestroy() {\n    this.destroy$.next(true);\n    this.destroy$.unsubscribe();\n  }\n  static #_ = this.ɵfac = function TimeService_Factory(t) {\n    return new (t || TimeService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: TimeService,\n    factory: TimeService.ɵfac,\n    providedIn: \"root\"\n  });\n}","map":{"version":3,"names":["timer","BehaviorSubject","Subscription","Subject","takeUntil","map","TimeService","initialTime","secondClick","delay","timer$","lastStopedTime","timerSubscription","isRunning","constructor","destroy$","stopWatch$","pipe","seconds","secondsToStopWatch","startCount","value","subscribe","stopTimer","unsubscribe","resetTimer","next","waitCount","Date","now","rest","hours","Math","floor","minutes","convertToNumberString","ngOnDestroy","_","_2","factory","ɵfac","providedIn"],"sources":["D:\\Internship\\Task1_stopwatch\\Stopwatch\\src\\app\\timer.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport {\r\n  Observable,\r\n  timer,\r\n  BehaviorSubject,\r\n  Subscription, \r\n  Subject, \r\n  interval\r\n} from \"rxjs\";\r\nimport { takeUntil } from 'rxjs/operators';\r\n\r\nimport { map } from \"rxjs/operators\";\r\nimport { StopWatch } from \"./stop-watch.interface\";\r\n\r\n@Injectable({\r\n  providedIn: \"root\"\r\n})\r\nexport class TimeService {\r\n  readonly #initialTime = 0;\r\n  #secondClick = false;\r\n  #delay = 0;\r\n\r\n\r\n\r\n  #timer$: BehaviorSubject<number> = new BehaviorSubject(\r\n    this.#initialTime\r\n  );\r\n  #lastStopedTime: number = this.#initialTime;\r\n  #timerSubscription: Subscription = new Subscription();\r\n  destroy$: Subject<boolean> = new Subject<boolean>();\r\n  #isRunning: boolean = false;\r\n\r\n  constructor() {}\r\n\r\n  public get stopWatch$(): Observable<StopWatch> {\r\n    return this.#timer$.pipe(\r\n      map((seconds: number): StopWatch => this.secondsToStopWatch(seconds))\r\n    );\r\n  }\r\n\r\n  startCount(): void {\r\n    if (this.#isRunning) {\r\n      return;\r\n    }\r\n    this.#timerSubscription = timer(0, 1000) // Timer, so that the first emit is instantly (interval waits until the period is over for the first emit)\r\n      .pipe(takeUntil(this.destroy$), map((value: number): number => value + this.#lastStopedTime))\r\n      .subscribe(this.#timer$); // each emit of the Observable will result in a emit of the BehaviorSubject timer$\r\n    this.#isRunning = true;\r\n  }\r\n\r\n  stopTimer(): void {\r\n    this.#lastStopedTime = this.#timer$.value;\r\n    this.#timerSubscription.unsubscribe();\r\n    this.#isRunning = false;\r\n  }\r\n\r\n  resetTimer(): void {\r\n    this.#timerSubscription.unsubscribe();\r\n    this.#lastStopedTime = this.#initialTime;\r\n    this.#timer$.next(this.#initialTime);\r\n    this.#isRunning = false;\r\n  }\r\n\r\n  waitCount(): void {\r\n    if(!this.#secondClick){\r\n      this.#secondClick = true\r\n      this.#delay = Date.now();\r\n      return\r\n    }\r\n    if(Date.now() - this.#delay <= 300){\r\n      this.#lastStopedTime = this.#timer$.value;\r\n      this.#timerSubscription.unsubscribe();\r\n      this.#isRunning = false;\r\n    }\r\n    this.#secondClick = false\r\n  }\r\n\r\n  private secondsToStopWatch(seconds: number): StopWatch {\r\n    let rest = seconds;\r\n    const hours = Math.floor(seconds / 3600);\r\n    rest = seconds % 3600;\r\n    const minutes = Math.floor(rest / 60);\r\n    rest = seconds % 60;\r\n\r\n    this.#secondClick = false;\r\n    \r\n    return {\r\n      hours: this.convertToNumberString(hours),\r\n      minutes: this.convertToNumberString(minutes),\r\n      seconds: this.convertToNumberString(rest),\r\n    };\r\n  }\r\n\r\n  private convertToNumberString(value: number): string {\r\n    return `${value < 10 ? \"0\" + value : value}`;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.destroy$.next(true);\r\n    this.destroy$.unsubscribe();\r\n  }\r\n}\r\n"],"mappings":"AACA,SAEEA,KAAK,EACLC,eAAe,EACfC,YAAY,EACZC,OAAO,QAEF,MAAM;AACb,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,SAASC,GAAG,QAAQ,gBAAgB;;AAMpC,OAAM,MAAOC,WAAW;EACb,CAAAC,WAAY;EACrB,CAAAC,WAAY;EACZ,CAAAC,KAAM;EAIN,CAAAC,MAAO;EAGP,CAAAC,cAAe;EACf,CAAAC,iBAAkB;EAElB,CAAAC,SAAU;EAEVC,YAAA;IAdS,MAAAP,WAAY,GAAG,CAAC;IACzB,MAAAC,WAAY,GAAG,KAAK;IACpB,MAAAC,KAAM,GAAG,CAAC;IAIV,MAAAC,MAAO,GAA4B,IAAIT,eAAe,CACpD,IAAI,CAAC,CAAAM,WAAY,CAClB;IACD,MAAAI,cAAe,GAAW,IAAI,CAAC,CAAAJ,WAAY;IAC3C,MAAAK,iBAAkB,GAAiB,IAAIV,YAAY,EAAE;IACrD,KAAAa,QAAQ,GAAqB,IAAIZ,OAAO,EAAW;IACnD,MAAAU,SAAU,GAAY,KAAK;EAEZ;EAEf,IAAWG,UAAUA,CAAA;IACnB,OAAO,IAAI,CAAC,CAAAN,MAAO,CAACO,IAAI,CACtBZ,GAAG,CAAEa,OAAe,IAAgB,IAAI,CAACC,kBAAkB,CAACD,OAAO,CAAC,CAAC,CACtE;EACH;EAEAE,UAAUA,CAAA;IACR,IAAI,IAAI,CAAC,CAAAP,SAAU,EAAE;MACnB;;IAEF,IAAI,CAAC,CAAAD,iBAAkB,GAAGZ,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;IAAA,CACtCiB,IAAI,CAACb,SAAS,CAAC,IAAI,CAACW,QAAQ,CAAC,EAAEV,GAAG,CAAEgB,KAAa,IAAaA,KAAK,GAAG,IAAI,CAAC,CAAAV,cAAe,CAAC,CAAC,CAC5FW,SAAS,CAAC,IAAI,CAAC,CAAAZ,MAAO,CAAC,CAAC,CAAC;IAC5B,IAAI,CAAC,CAAAG,SAAU,GAAG,IAAI;EACxB;EAEAU,SAASA,CAAA;IACP,IAAI,CAAC,CAAAZ,cAAe,GAAG,IAAI,CAAC,CAAAD,MAAO,CAACW,KAAK;IACzC,IAAI,CAAC,CAAAT,iBAAkB,CAACY,WAAW,EAAE;IACrC,IAAI,CAAC,CAAAX,SAAU,GAAG,KAAK;EACzB;EAEAY,UAAUA,CAAA;IACR,IAAI,CAAC,CAAAb,iBAAkB,CAACY,WAAW,EAAE;IACrC,IAAI,CAAC,CAAAb,cAAe,GAAG,IAAI,CAAC,CAAAJ,WAAY;IACxC,IAAI,CAAC,CAAAG,MAAO,CAACgB,IAAI,CAAC,IAAI,CAAC,CAAAnB,WAAY,CAAC;IACpC,IAAI,CAAC,CAAAM,SAAU,GAAG,KAAK;EACzB;EAEAc,SAASA,CAAA;IACP,IAAG,CAAC,IAAI,CAAC,CAAAnB,WAAY,EAAC;MACpB,IAAI,CAAC,CAAAA,WAAY,GAAG,IAAI;MACxB,IAAI,CAAC,CAAAC,KAAM,GAAGmB,IAAI,CAACC,GAAG,EAAE;MACxB;;IAEF,IAAGD,IAAI,CAACC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAApB,KAAM,IAAI,GAAG,EAAC;MACjC,IAAI,CAAC,CAAAE,cAAe,GAAG,IAAI,CAAC,CAAAD,MAAO,CAACW,KAAK;MACzC,IAAI,CAAC,CAAAT,iBAAkB,CAACY,WAAW,EAAE;MACrC,IAAI,CAAC,CAAAX,SAAU,GAAG,KAAK;;IAEzB,IAAI,CAAC,CAAAL,WAAY,GAAG,KAAK;EAC3B;EAEQW,kBAAkBA,CAACD,OAAe;IACxC,IAAIY,IAAI,GAAGZ,OAAO;IAClB,MAAMa,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACf,OAAO,GAAG,IAAI,CAAC;IACxCY,IAAI,GAAGZ,OAAO,GAAG,IAAI;IACrB,MAAMgB,OAAO,GAAGF,IAAI,CAACC,KAAK,CAACH,IAAI,GAAG,EAAE,CAAC;IACrCA,IAAI,GAAGZ,OAAO,GAAG,EAAE;IAEnB,IAAI,CAAC,CAAAV,WAAY,GAAG,KAAK;IAEzB,OAAO;MACLuB,KAAK,EAAE,IAAI,CAACI,qBAAqB,CAACJ,KAAK,CAAC;MACxCG,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAACD,OAAO,CAAC;MAC5ChB,OAAO,EAAE,IAAI,CAACiB,qBAAqB,CAACL,IAAI;KACzC;EACH;EAEQK,qBAAqBA,CAACd,KAAa;IACzC,OAAO,GAAGA,KAAK,GAAG,EAAE,GAAG,GAAG,GAAGA,KAAK,GAAGA,KAAK,EAAE;EAC9C;EAEAe,WAAWA,CAAA;IACT,IAAI,CAACrB,QAAQ,CAACW,IAAI,CAAC,IAAI,CAAC;IACxB,IAAI,CAACX,QAAQ,CAACS,WAAW,EAAE;EAC7B;EAAC,QAAAa,CAAA,G;qBAnFU/B,WAAW;EAAA;EAAA,QAAAgC,EAAA,G;WAAXhC,WAAW;IAAAiC,OAAA,EAAXjC,WAAW,CAAAkC,IAAA;IAAAC,UAAA,EAFV;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}