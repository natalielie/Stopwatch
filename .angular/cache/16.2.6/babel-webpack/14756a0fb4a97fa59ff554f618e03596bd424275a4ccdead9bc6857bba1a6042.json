{"ast":null,"code":"import { timer, BehaviorSubject, Subscription, fromEvent } from \"rxjs\";\nimport { debounceTime, map, buffer, filter } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\n/**\n * Stopwatch service that provides the main functionality using RxJS\n */\nexport class StopwatchService {\n  #initialTime = 0;\n  #secondClick = false;\n  #actualDelay = 0;\n  #delayTime = 300;\n  #timer$ = new BehaviorSubject(this.#initialTime);\n  #lastStopedTime = this.#initialTime;\n  #timerSubscription = new Subscription();\n  #isRunning = false;\n  constructor() {}\n  /**\n  * Get the stopwatch Observable\n  *\n  * @param StopWatch stopwatch interface\n  */\n  get stopWatch$() {\n    return this.#timer$.pipe(map(seconds => this.secondsToStopWatch(seconds)));\n  }\n  startCount() {\n    if (this.#isRunning) {\n      return;\n    }\n    this.#timerSubscription = timer(0, 1000) // Timer, so that the first emit is instantly (interval waits until the period is over for the first emit)\n    .pipe(map(value => value + this.#lastStopedTime)).subscribe(this.#timer$); // each emit of the Observable will result in a emit of the BehaviorSubject timer$\n    this.#isRunning = true;\n  }\n  stopCount() {\n    this.#lastStopedTime = this.#timer$.value;\n    this.#timerSubscription.unsubscribe();\n    this.#isRunning = false;\n  }\n  resetStopwatch() {\n    this.#timerSubscription.unsubscribe();\n    this.#lastStopedTime = this.#initialTime;\n    this.#timer$.next(this.#initialTime);\n    this.#isRunning = false;\n  }\n  /**\n  * Checks if there were two consecutive clicks within 300ms and stops the time\n  */\n  waitCount() {\n    const mouse$ = fromEvent(document, 'click');\n    const buff$ = mouse$.pipe(debounceTime(300));\n    const click$ = mouse$.pipe(buffer(buff$), map(list => {\n      return list.length;\n    }), filter(x => x === 2));\n    click$.subscribe(() => this.stopCount());\n  }\n  /**\n  * Format time to display properly\n  *\n  * @param seconds used to convert seconds to format hh:mm:ss\n  */\n  secondsToStopWatch(seconds) {\n    let rest = seconds;\n    const hours = Math.floor(seconds / 3600);\n    rest = seconds % 3600;\n    const minutes = Math.floor(rest / 60);\n    rest = seconds % 60;\n    return {\n      hours: this.convertToNumberString(hours),\n      minutes: this.convertToNumberString(minutes),\n      seconds: this.convertToNumberString(rest)\n    };\n  }\n  convertToNumberString(value) {\n    return `${value < 10 ? \"0\" + value : value}`;\n  }\n  static #_ = this.ɵfac = function StopwatchService_Factory(t) {\n    return new (t || StopwatchService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: StopwatchService,\n    factory: StopwatchService.ɵfac,\n    providedIn: \"root\"\n  });\n}","map":{"version":3,"names":["timer","BehaviorSubject","Subscription","fromEvent","debounceTime","map","buffer","filter","StopwatchService","initialTime","secondClick","actualDelay","delayTime","timer$","lastStopedTime","timerSubscription","isRunning","constructor","stopWatch$","pipe","seconds","secondsToStopWatch","startCount","value","subscribe","stopCount","unsubscribe","resetStopwatch","next","waitCount","mouse$","document","buff$","click$","list","length","x","rest","hours","Math","floor","minutes","convertToNumberString","_","_2","factory","ɵfac","providedIn"],"sources":["D:\\Internship\\Task1_stopwatch\\Stopwatch\\src\\app\\stopwatch.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport {\r\n  Observable,\r\n  timer,\r\n  BehaviorSubject,\r\n  Subscription,\r\n  fromEvent\r\n} from \"rxjs\";\r\nimport { debounceTime, map, buffer, filter } from 'rxjs/operators';\r\n\r\nimport { StopWatch } from \"./stopwatch.interface\";\r\n\r\n@Injectable({\r\n  providedIn: \"root\"\r\n})\r\n\r\n/**\r\n * Stopwatch service that provides the main functionality using RxJS\r\n */\r\nexport class StopwatchService {\r\n  readonly #initialTime = 0;\r\n  #secondClick = false;\r\n  #actualDelay = 0;\r\n  #delayTime = 300;\r\n\r\n  #timer$: BehaviorSubject<number> = new BehaviorSubject(\r\n    this.#initialTime\r\n  );\r\n  #lastStopedTime: number = this.#initialTime;\r\n  #timerSubscription: Subscription = new Subscription();\r\n  #isRunning: boolean = false;\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n * Get the stopwatch Observable\r\n *\r\n * @param StopWatch stopwatch interface\r\n */\r\n  public get stopWatch$(): Observable<StopWatch> {\r\n    return this.#timer$.pipe(\r\n      map((seconds: number): StopWatch => this.secondsToStopWatch(seconds))\r\n    );\r\n  }\r\n\r\n  startCount(): void {\r\n    if (this.#isRunning) {\r\n      return;\r\n    }\r\n    this.#timerSubscription = timer(0, 1000) // Timer, so that the first emit is instantly (interval waits until the period is over for the first emit)\r\n      .pipe(map((value: number): number => value + this.#lastStopedTime))\r\n      .subscribe(this.#timer$); // each emit of the Observable will result in a emit of the BehaviorSubject timer$\r\n    this.#isRunning = true;\r\n  }\r\n\r\n  stopCount(): void {\r\n    this.#lastStopedTime = this.#timer$.value;\r\n    this.#timerSubscription.unsubscribe();\r\n    this.#isRunning = false;\r\n  }\r\n\r\n  resetStopwatch(): void {\r\n    this.#timerSubscription.unsubscribe();\r\n    this.#lastStopedTime = this.#initialTime;\r\n    this.#timer$.next(this.#initialTime);\r\n    this.#isRunning = false;\r\n  }\r\n\r\n  /**\r\n * Checks if there were two consecutive clicks within 300ms and stops the time\r\n */  \r\n  waitCount(): void {\r\n    const mouse$ = fromEvent(document, 'click')\r\n    const buff$ = mouse$.pipe(\r\n      debounceTime(300),\r\n    )\r\n    const click$ = mouse$.pipe(\r\n      buffer(buff$),\r\n      map(list => {\r\n        return list.length;\r\n      }),\r\n      filter(x => x === 2),\r\n    )\r\n    click$.subscribe(() => \r\n          this.stopCount()\r\n        );\r\n    }\r\n\r\n  /**\r\n * Format time to display properly\r\n *\r\n * @param seconds used to convert seconds to format hh:mm:ss\r\n */\r\n  private secondsToStopWatch(seconds: number): StopWatch {\r\n    let rest = seconds;\r\n    const hours = Math.floor(seconds / 3600);\r\n    rest = seconds % 3600;\r\n    const minutes = Math.floor(rest / 60);\r\n    rest = seconds % 60;\r\n\r\n    return {\r\n      hours: this.convertToNumberString(hours),\r\n      minutes: this.convertToNumberString(minutes),\r\n      seconds: this.convertToNumberString(rest),\r\n    };\r\n  }\r\n\r\n  private convertToNumberString(value: number): string {\r\n    return `${value < 10 ? \"0\" + value : value}`;\r\n  }\r\n\r\n  \r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}